#!/data/data/com.termux/files/usr/bin/bash
# vextuClone - comando principal que descarga librer√≠as desde GitHub si no existen

LIB_DIR="$HOME/.vextuClone-lib"
LIB_NET="$LIB_DIR/network.sh"
LIB_PARSER="$LIB_DIR/parser.sh"

# Crear carpeta de librer√≠as si no existe
mkdir -p "$LIB_DIR"

# URLs de tus librer√≠as en GitHub
URL_NET="https://raw.githubusercontent.com/WM-HTML/VextuClone/refs/heads/main/network.sh"
URL_PARSER="https://raw.githubusercontent.com/WM-HTML/VextuClone/refs/heads/main/parser.sh"

# Descargar librer√≠as si faltan
[ ! -f "$LIB_NET" ] && echo "üîΩ Descargando librer√≠a network.sh..." && curl -s -o "$LIB_NET" "$URL_NET"
[ ! -f "$LIB_PARSER" ] && echo "üîΩ Descargando librer√≠a parser.sh..." && curl -s -o "$LIB_PARSER" "$URL_PARSER"

# Verificar si se descargaron
if [ ! -f "$LIB_NET" ] || [ ! -f "$LIB_PARSER" ]; then
    echo "‚ùå No se pudieron descargar las librer√≠as. Revisa tu conexi√≥n o URLs."
    exit 1
fi

# Cargar librer√≠as
source "$LIB_NET"
source "$LIB_PARSER"

URL="$1"
if [ -z "$URL" ]; then
    echo "Uso: vextuClone <web>"
    exit 1
fi

WEBNAME=$(echo "$URL" | sed -E 's#https?://##; s#[^a-zA-Z0-9]#_#g')
DEST="/sdcard/Download/VextuClone/$WEBNAME"
mkdir -p "$DEST"

echo "üåê Descargando $URL a $DEST..."

# Descargar HTML principal
download_file "$URL" "$DEST/index.html"

# Descargar CSS, JS, JSON, Im√°genes
for type in css js json img; do
    func="extract_$type"
    $func "$DEST/index.html" | while read file; do
        echo "üìÑ $type: $file"
        download_file "$URL/$file" "$DEST/$(basename $file)"
    done
done

echo "‚úÖ Descarga completada en $DEST"
